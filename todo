--------------February 2021--------------------------------------------------------------
esc
log rule messages
- help context menu for all help (conception, handler, keyboard/mouse..)
  Look up all code, format all code (by vs code) and comment all code. some vars from let to const, always check on macbook via git
- Task manager and object process SCHEDULER. Handlers are executed by built-in system user.
- System calls and its object views: LINK (+Element statistic, for a example, client list to warn by email, or client quantity)

--------------March 2021--------------------------------------------------------------
- System calls and its object views: QUERY (sql request just to select data from current (or other) OD, for example to release setki.xls)
- System calls UPLOADFILE, DOWNLOADFILE, DELETEFILE, GALLERYJPGFILES (in case of 'image' prop set - image is displayed on the table insted of text value prop; don't forget image files handle for text.php). Images saved in OD/oId/eId/ dir
- telnet function by SLAVA
- snmp function by SLAVA?
- diagnostic function by me
- inner text in <td> can consists of <br>, <color> and <font> tags
- firefox up/down and left/right arrows scroll page
- multi cell selecting - copy (Plain text or excel table?:), delete (removes all selected objects)
  single table cell copying and then pasting (by Ctrl+V) - it will be plain text like in whatsapp (without html tags); want to support hot key undependent on keyboard layout? Use event.code - https://learn.javascript.ru/keyboard-events
  User can copy whole object, then paste it (new object of buffered object instance will be inserted). INIT event won't be applied in that case
  User can copy an image to the cell?
- Object view PIECHART, GRAPH, LOCATION.
- see through all OD properties dialog box and try to check/release their all features (output in edit OD real current DB size, object count and versions count)

--------------Later or doubt features-------------------------------------------------
- Dialog Box features: arrow icon for select, expanded list sort on alphabet/appearance (increasing, decreasing) via arrows on right side from the select div, highlite 'New rule|view|element' in the expanded div, radio tag (and may be not only this  tag) loses its positin after textarea tag in case of no 'line': ''
- EDIT controller cmd limits text lines number to edit https://toster.ru/q/355711     https://toster.ru/q/518758   http://qaru.site/questions/190792/limiting-number-of-characters-in-a-contenteditable-div
- System call NEWOBJECT (to create object by user handlers)
- Export OV data to xls, pdf or txt file
- Secure database and sources to avoid assignment of my intellectual property. Incuded php files should be on unaccessable for user and not application dir. Restrict function dir from observing at the browser.
- OD Dialog Box - OD icon, OV icon, OV shortcut key
- Autonavigate command for OV, for a example single mouse click on a cell edit the element. Mouse single click command: NONE|DBLCLICK|KEYPRESS. Usefull for chats
- Parent OD (daughter OD has only OVs that uses database of parent OD, so it is useful to divide OV betewen two or more OD)
- Predefined system messages can be displayed on other languages
- not all parameters of element data json should be passed to the browser. if to read JSON from OD, then decode it, then remove unnecessary props, then encode it back - to many manipulations can risk some corruptions. It is simplier hidden data to be saved in files for whole OD or for every element - this feature will be released.
- Per user separate OV permission to view-in-sidebar and add-edit-delete with low priority
- style/hint/description edit for text.php? The problem is that style/hint/description data should be transmitted automatically,
  and it is hard to insert style/hint/description props to every element in OD properties dialog
- fool protection by not allowing to block all users from changing DB props, so none can add/delete/change views, elements and rules.
- event json can send not only current objects elements, but other objects of current OD and other objects of another OD
- Pagination. Should i use it or app concept is to out whole selection and manage object number by its object selection?
  should i use page output when next portion of objects are displayed by reaching screen bottom at scrolling? So implemet object-per-page (and other features around) in user customization misc configuration
- Secure: check origin header to be http or https to 192.168.9.39, The point here is, you have to check your websocket activity and determine rate limit: https://www.freecodecamp.org/news/how-to-secure-your-websocket-connections-d0be0996c556/
- socket rate limit https://javascript.info/websocket#rate-limiting
  To prevent user DDOS by user pressing F2 (for a example) user handler should be executed as a apparent apps and only once by one user?
- Make OD/OV array that consists of socket indexes that every OV of every OD are subscribed of. It is just to have quicker access on OV change to serve big amount of connects
- Request changes of contenteditable cell after content is applied when other user has already changed the content while the cell being editable.
- As a result of EDIT command client generates CONFIRM event. Handler should answer to 'CONFIRM' by SET/RESET otherwise (no answer at all or nonSET event like DIALOG,EDIT,ALERT,CALL) it is a handler return data error couse editing cell still contains unactual data.
  So should CONFIRM event be splited to CONFIRMEDIT and CONFIRMDIALOG?
  May be set hint to these error cells and all cells with hint are merked with the footnote (snoska)
- Adaptivka after browser window size has changed dialog box has gone away
- divide core.php to make separate php file to be included in wrapper.php to make wrapper execution more faster
- https access only, certificate, set cookie parameter: 'secure' = false --> 'secure' = true
  renew php and add samesite session attr: https://www.php.net/manual/ru/function.session-set-cookie-params.php
  Use another user (instead of root) with priv granted to 'OEDB' database only and Unicode for MySQL    https://mathiasbynens.be/notes/mysql-utf8mb4 http://phpfaq.ru/mysql/charset
  Linux to docker, secure php.ini, optimize mysql to highload app
  ws -> wss https://petukhovsky.com/simple-web-socket-php-ssl/
  Problems of deploying - can i use mysql on commerisal base? Can i use sockets number more than 1024?
- Some systems emulation:
  Corp chat
  Corp book
  Any request app (Helpdesk, Jira)
  MRTG
  Zabbix
  CRM
  ACS
  Any accounting system (may be billing)
  Some excel functions
  Voting
  Any statistic/analitycs
  Setki.xls
  Paraga mail functional
  Ask Hramcova analitiku po helpdesku
  See functions on Slava's management system
- Operations.xls emulation:
  Switch ip, switch description, switch location,
  60 ports (description), for every port: type (uplink,downlink,free,service,client),
  diagnostic (pings, grafiki, port config, port errors, asr speed, mac, mac-vendor, checkhost, name from billing) and convert all this info to pdf in a new tab, if port type is 'client', then display client name from billing
  In INFO scheme find mac on every switch in OV
  In setki - ip, name from TABELS, name from BILLING, mac (for buhgalters and FSB)
  Button to destruct client conf,int et 1/0/2,shut, no fl c, no band c,  sw mode acc,  sw acc vl 666,  speed aut, end,wr
  see client mac, cable length, errors and all other data the switch allows to monitor
- application customization: current view refreshat sidebar OV select will show 'loading..' and reload main div or not; autorefresh OV (for example for chats or for small views) or show digits in red scope as footnoe on sidebar OV div 
------------------------------------------------------------------------------------------






Client, controller and element-handler interaction:
------Client (browser) input event------	-------Controller------							------Element handler------

REFRESHMAIN					data..
{cmd,OD,OV,sId}					<=
-----------------------------------------------------------------------------------------------------------
REFRESHMENU					data..
{cmd,OD,OV,sId}					<=
-----------------------------------------------------------------------------------------------------------
NEWOBJECT					=>									{ "cmd": "SET", "data[]={"oId", "eId", "element"}", "refreshMenu", "alert" }
{cmd,["data": array[id]=element],OD,OV,sId}	{ "cmd": "INFO", "log", "error", "alert" }				<=
						{ "cmd": "REFRESH", "OD", "OV" }
-----------------------------------------------------------------------------------------------------------
DELETEOBJECT					=>
{cmd,OD,OV,oId,sId}				{ "cmd": "INFO", "log", "error", "alert" }				<=
						{ "cmd": "REFRESH", "OD", "OV" }
-----------------------------------------------------------------------------------------------------------
DBLCLICK,F2,F12,INS,DEL				=>									{ "cmd": "EDIT", "oId", "eId", "data", "lines" }
{cmd,OD,OV,oId,eId,sId}													{ "cmd": "SET", "data[]={"oId", "eId", "element"}", "refreshMenu", "alert", "log" }
															{ "cmd": "NEWOD|NEWOV|NEWELEMENT", "data" }
CONFIRM,KEYPRESS,OBJCHANGE			{ "cmd": "INFO", "log", "error", "alert" }				<=
{cmd,data,OD,OV,oId,eId,sId}			{ "cmd": "REFRESH", "OD", "OV" }					
---------------------------------------------------------------------------------------------------------------------------------------------------




Browser commands to the controller (fixed):
    { "cmd":	"GETMENU|GETMAIN|GETUI|INIT|DELETEOBJECT|DBLCLICK|KEYPRESS|CONFIRM"
      "OD":	"<OD name>"
      "OV":	"<OV name>"
      "data":	"[eId=>data, eId=>data..] for INIT|<key code> for KEYPRESS|<cell data> or <dialog json data> for CONFIRM"
      "oId":	"<object id>"
      "eId":	"<element id>"
      "sId":	"<session id>" }


Controller commands to the browser:
    { "cmd":		"REFRESH|REFRESHMAIN|REFRESHMENU|EDIT<LINES_NUM>|DIALOG|SET|RESET"
      "OD":		"<OD name>"
      "OV":		"<OV name>"
      "data":		"<json>|<text>"
      "oId":		"<object id>"
      "eId":		"<element id>"
      "alert":		"<alert message>"
      "log":		"<browser console log message>"
      "error":		"<main view error message>"
      "callbackcmd":	"REFRESHMENU" }

Element handler commands to the controller:
    { "cmd":		"EDIT[<LINES_NUM>]|DIALOG|ALERT"
      "data":		"<text data for EDIT|ALERT>|<json data for DIALOG>" }
    { "cmd":		"SET|RESET"
      "alert":		"<alert message>"
      "value":		"view cell data" 
      "image":		"image to display instead of value text"
      "link":		"" 
      "location":	"" 
      "hint":		"" 
      "style":		"" 
      "<any property>":	"<any value>" }

Controller to the element handler:
    { "cmd":		"INIT|DBLCLICK|KEYPRESS|CONFIRM|ONCHANGE"
      "user":		"<username initiated the process>"
      "title":		"element title"
      "data":		"<key code for KEYPRESS>|<element value for CONFIRM or NEWOBJECT>|<dialog json data for CONFIRM>"
      "<any property>":	'<json {"OD": "", "oId": "", "eId": "", "property": ""}|<string>' }




---------------------Source code requirement-------------------------------------------------------
- formatting                                                   
- error behaviour (no object, no elements, no items, etc..)    
- php files change double qoutes to single quotes                                      
- all comments should be here in system features
- comment all code                                             
- all error message should be more detailed (by now alert used only)
- jslint.com                                                   
- single char variable exclude
- array to []
- sql commands with big letters
- remove useless loog
-----------------------------------WIKI-----------------------------------------------------
interface examples:
- https://qna.habr.com/q/281940
- https://htmlacademy.ru/blog/video/shorts/short-4
- table column resize https://codepen.io/barring/pen/ZNObZg
Search JSON values:
- https://dev.mysql.com/doc/refman/8.0/en/json-search-functions.html
- https://proselyte.net/tutorials/sql/nested-queries/
- https://codetown.ru/sql/vlozhennye-zaprosy/
- https://site-do.ru/db/sql4.php
Secure:
- Meta tags to block request to other sites   https://www.searchengines.ru/meta_teg_referr_s.html   https://www.sitepoint.com/8-practices-to-secure-your-web-app/ https://www.smashingmagazine.com/2012/11/writing-fast-memory-efficient-javascript/
-------------------------Set cursor at the end of the text. Decided not to use it cause fuckin FF inserting new line in that case-----------
const range = document.createRange();   
const selection = window.getSelection();

range.selectNodeContents(focusElement.td);
range.collapse(false);
selection.removeAllRanges();                                                                                
selection.addRange(range);
--------------------------2021:--------------------
- React/Redux, Node js/NPM, Webpack https://ru.react.js.org/docs/getting-started.html https://ru.react.js.org/docs/cdn-links.html https://medium.com/@badiullin.nail/-[---4bcfd8e74c78
- Git https://habr.com/ru/post/174467/    https://proglib.io/p/git-for-half-an-hour/   https://git-scm.com/book/en/v2 https://proglib.io/p/git-github-gitflow
--------------------------SVG:--------------------------
- https://habr.com/ru/sandbox/122675/
- https://developer.mozilla.org/en-US/docs/Web/SVG/Element/svg
- https://css-tricks.com/lodge/svg/09-svg-data-uris/
--------------------------Input style:--------------------------
- http://jsfiddle.net/js5x06nL/
--------------------------JWT:--------------------------
- https://gist.github.com/zmts/802dc9c3510d79fd40f9dc38a12bccfc https://habr.com/ru/post/340146/
--------------------------Git:--------------------------
- #git commit -a -m "INIT command ver4"
- git commit -a -m "CreateNewObjectVersion function ver2"
- git push -u origin master
- lefffan
- git pull origin # Nakatit v local repositary last code version before work
--------------------------DB SQL manage:--------------------------
- drop database OE8; create database OE8; use OE8; show tables;
- drop database OE6; create database OE6; use OE6; show tables;
- create table `uniq_2` (id MEDIUMINT NOT NULL AUTO_INCREMENT, PRIMARY KEY (id)) ENGINE InnoDB CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;


user.php
{"event":"INIT"}
{ "event": "DBLCLICK", "account": {"prop": "value"}, "odaddperm": {"prop": "odaddperm"}, "groups": {"prop": "groups"} }


{"eid": "1", "oid": "0", "x":"o", "y":"n", "startevent":"KEYPRESSjl;k\njjj "}
{"eid": "2", "oid": "0", "x":"0", "y":"n"}


On password change - all sessions should be dropped
Other place auth - all sessions should be dropped

user-id IP user-agent hash(ip,user-agent,pass-hash)


What to check in relibe auth
1. User absence or password changed
2. Cookie absence
3. Browser and server time doesn't match
4. Relogin after SESSIONLIFETIME even browser hasn't ever closed
------------------------------------------------------------




web components
js
1 framework
youtube sobes voprosy
git
form html tag
VS Code on youtube
roadmap also on youtube
C:\!\sobes
see zametki v telefone
CORS
get and POST differentional






$query = $db->prepare("SELECT id,version,owner,datetime,lastversion$elementQueryString FROM `data_$odid` WHERE lastversion=1 AND version!=0");
$query = $db->prepare("SELECT id,version,owner,datetime,lastversion$elementQueryString FROM `data_$odid`");                                   
WHERE (select datetime from data_1 WHERE owner='system')>0;
IAM: WHERE lastversion=1 AND version!=0 and eid1->>'$.value'=':user'
e: *
test obj sel: WHERE lastversion=1 AND version!=0 and eid1->>'$.value'!=':input_user'
test el sel:

{"event":"INIT"}
{"event": "DBLCLICK"}
{"event": "KEYPRESS"}


{"ollapse":""}
{"eid":"1", "oid":"2", "x":"0", "y":"0", "style":"color: white;"}
{"eid":"1", "oid":"1", "x":"0", "y":"1", "style":"color: red;"}
{"eid":"1", "x":"0", "y":"n+3"}

{"eid":"2", "oid":"1", "x":"1", "y":"1", "tartevent":"DBLCLICK"}
{"eid":"2", "oid":"2", "x":"1", "y":"0"}
{"eid":"2", "x":"1", "y":"n+3"}

{"eid":"3", "oid":"1", "x":"2", "y":"1"}
{"eid":"3", "oid":"2", "x":"2", "y":"0"}
{"eid":"3", "x":"2", "y":"n+3", "collaps":""}

{"eid":"datetime", "oid":"1", "x":"3", "y":"1"}
{"eid":"datetime", "oid":"2", "x":"3", "y":"0"}
{"eid":"datetime", "x":"3", "y":"n+3"}

{"eid":"owner", "oid":"1", "x":"4", "y":"1"}
{"eid":"owner", "oid":"2", "x":"4", "y":"0"}
{"eid":"owner", "x":"4", "y":"n+3"}

{"eid":"version", "oid":"1", "x":"5", "y":"1"}
{"eid":"version", "oid":"2", "x":"5", "y":"0"}
{"eid":"version", "x":"5", "y":"n+3"}









const mainObjectContext = '                                               
<div class="contextmenuItems">New Object</div>                            
<div class="contextmenuItems">Delete Object</div>                         
<div class="contextmenuItems">Description</div>                           
<div class="contextmenuItems">Help</div>';                                
const mainTitleObjectContext = '                                          
<div class="contextmenuItems">New Object</div>                            
<div class="contextmenuItems greyContextMenuItem">Delete Object</div>     
<div class="contextmenuItems">Description</div>                           
<div class="contextmenuItems">Help</div>';                                
const mainDefaultContext = '                                              
<div class="contextmenuItems">New Object</div>                            
<div class="contextmenuItems greyContextMenuItem">Delete Object</div>     
<div class="contextmenuItems greyContextMenuItem">Description</div>       
<div class="contextmenuItems">Help</div>';                                



REFRESH cmd from the controller also sends current page and page number that is corrected as an answer on client GETMAIN message
-Also page and pageNum should be reset in DisplaymainError function - what is it for?

objectsOnThePage is set in DrawMain and output objectsOnThePage in the description

- objectsPerPage and other props (like next page bottom reach and etc..) are set in uiProfileSet function as an answer to the cutomization and should be added some info in uiProfile array
objectsPerPage should be output in description
-objectsPerPage should be transfered to the controller


at start:
- client call login dialog

at end login dialog:
- create new websocket connection
- wait for an answer: success (user logged in), fail (wrong pass or socket connection refused)

at any action:
- ping/pong: websocket alive - everything's good, not alive - login dialog

php threads: https://phpprofi.ru/blogs/post/55

echo '\'{"a":"b"}\'' | php ./wrapper.php




Client(Browser) <-> Server(Controller) -> Handler(wrapper.php)

handler_queue ($$.sql) view_queue ($$$.sql)




Application on Macbook:
192.168.9.39 -> 127.0.0.1 on main.js and main.php
const PHPBINARY				= '/usr/bin/php';
const HANDLERDIR			= '/Library/WebServer/Documents/handlers/';
php ./makedb.php
php ./main.php



WHERE lastversion=1 AND version!=0 and eid2->>'$.value'!=':Input_user'



OD chat:
- 1 element with init handler: /usr/local/bin/php /usr/local/apache2/htdocs/handlers/text.php INIT <data>
- object selection: WHERE lastversion=1 AND version!=0 ORDER BY id DESC
- element selection: 
{"eid":"datetime", "x":"0", "y":"q-n-1", "style": "border: none;"}
{"eid":"owner", "x":"1", "y":"q-n-1", "style": "border: none;"}
{"eid":"1", "x":"2", "y":"q-n-1", "style": "border: none;"}
{"eid":"1", "oid":"1", "x":"2", "y":"q", "event":"", "style": "border: 1px solid;"}



{"eid":"datetime", "x":"0", "y":"q-n-1", "tyle": "border: none;"}
{"eid":"owner", "x":"1", "y":"q-n-1", "tyle": "border: none;"}
{"eid":"1", "x":"2", "y":"q-n-1", "tyle": "border: none;"}
{"eid":"1", "oid":"1", "x":"2", "y":"q", "event":"", "tyle": "border: 1px solid;"}



- 'not empty msgs' reject post rule (for add oper): eid1->>'$.value'=''
- 'not delete msgs' reject rule (for delete oper): both pre and post rules are empty
